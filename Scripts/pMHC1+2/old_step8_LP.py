import pandas as pd
import numpy as np
from Functions2 import *

Raw_data = pd.read_csv("MHC2_merged.csv")
Meta_data = Raw_data[~Raw_data["PDB_ID"].isin(["6DFS"])]
Meta_data = Meta_data.drop("Total_energy", axis=1)

#4~14 allcom
#combinations=[[4, 5, 6, 7], [4, 5, 6, 9], [4, 5, 6, 13], [4, 5, 7, 9], [4, 5, 7, 13], [4, 5, 9, 13], [4, 6, 7, 9], [4, 6, 7, 13], [4, 6, 9, 13], [4, 7, 9, 13], [5, 6, 7, 9], [5, 6, 7, 13], [5, 6, 9, 13], [5, 7, 9, 13], [6, 7, 9, 13], [4, 5, 6, 7, 9], [4, 5, 6, 7, 13], [4, 5, 6, 9, 13], [4, 5, 7, 9, 13], [4, 6, 7, 9, 13], [5, 6, 7, 9, 13], [4, 5, 6, 7, 9, 13]]
#4~24 com4
#combinations=[[4, 5, 6, 7], [4, 5, 6, 9], [4, 5, 6, 13], [4, 5, 6, 14], [4, 5, 6, 19], [4, 5, 6, 20], [4, 5, 7, 9], [4, 5, 7, 13], [4, 5, 7, 14], [4, 5, 7, 19], [4, 5, 7, 20], [4, 5, 9, 13], [4, 5, 9, 14], [4, 5, 9, 19], [4, 5, 9, 20], [4, 5, 13, 14], [4, 5, 13, 19], [4, 5, 13, 20], [4, 5, 14, 19], [4, 5, 14, 20], [4, 5, 19, 20], [4, 6, 7, 9], [4, 6, 7, 13], [4, 6, 7, 14], [4, 6, 7, 19], [4, 6, 7, 20], [4, 6, 9, 13], [4, 6, 9, 14], [4, 6, 9, 19], [4, 6, 9, 20], [4, 6, 13, 14], [4, 6, 13, 19], [4, 6, 13, 20], [4, 6, 14, 19], [4, 6, 14, 20], [4, 6, 19, 20], [4, 7, 9, 13], [4, 7, 9, 14], [4, 7, 9, 19], [4, 7, 9, 20], [4, 7, 13, 14], [4, 7, 13, 19], [4, 7, 13, 20], [4, 7, 14, 19], [4, 7, 14, 20], [4, 7, 19, 20], [4, 9, 13, 14], [4, 9, 13, 19], [4, 9, 13, 20], [4, 9, 14, 19], [4, 9, 14, 20], [4, 9, 19, 20], [4, 13, 14, 19], [4, 13, 14, 20], [4, 13, 19, 20], [4, 14, 19, 20], [5, 6, 7, 9], [5, 6, 7, 13], [5, 6, 7, 14], [5, 6, 7, 19], [5, 6, 7, 20], [5, 6, 9, 13], [5, 6, 9, 14], [5, 6, 9, 19], [5, 6, 9, 20], [5, 6, 13, 14], [5, 6, 13, 19], [5, 6, 13, 20], [5, 6, 14, 19], [5, 6, 14, 20], [5, 6, 19, 20], [5, 7, 9, 13], [5, 7, 9, 14], [5, 7, 9, 19], [5, 7, 9, 20], [5, 7, 13, 14], [5, 7, 13, 19], [5, 7, 13, 20], [5, 7, 14, 19], [5, 7, 14, 20], [5, 7, 19, 20], [5, 9, 13, 14], [5, 9, 13, 19], [5, 9, 13, 20], [5, 9, 14, 19], [5, 9, 14, 20], [5, 9, 19, 20], [5, 13, 14, 19], [5, 13, 14, 20], [5, 13, 19, 20], [5, 14, 19, 20], [6, 7, 9, 13], [6, 7, 9, 14], [6, 7, 9, 19], [6, 7, 9, 20], [6, 7, 13, 14], [6, 7, 13, 19], [6, 7, 13, 20], [6, 7, 14, 19], [6, 7, 14, 20], [6, 7, 19, 20], [6, 9, 13, 14], [6, 9, 13, 19], [6, 9, 13, 20], [6, 9, 14, 19], [6, 9, 14, 20], [6, 9, 19, 20], [6, 13, 14, 19], [6, 13, 14, 20], [6, 13, 19, 20], [6, 14, 19, 20], [7, 9, 13, 14], [7, 9, 13, 19], [7, 9, 13, 20], [7, 9, 14, 19], [7, 9, 14, 20], [7, 9, 19, 20], [7, 13, 14, 19], [7, 13, 14, 20], [7, 13, 19, 20], [7, 14, 19, 20], [9, 13, 14, 19], [9, 13, 14, 20], [9, 13, 19, 20], [9, 14, 19, 20], [13, 14, 19, 20]]

#4~24 com6
#combinations =[[4, 5, 6, 7, 9, 13], [4, 5, 6, 7, 9, 14], [4, 5, 6, 7, 9, 19], [4, 5, 6, 7, 9, 20], [4, 5, 6, 7, 13, 14], [4, 5, 6, 7, 13, 19], [4, 5, 6, 7, 13, 20], [4, 5, 6, 7, 14, 19], [4, 5, 6, 7, 14, 20], [4, 5, 6, 7, 19, 20], [4, 5, 6, 9, 13, 14], [4, 5, 6, 9, 13, 19], [4, 5, 6, 9, 13, 20], [4, 5, 6, 9, 14, 19], [4, 5, 6, 9, 14, 20], [4, 5, 6, 9, 19, 20], [4, 5, 6, 13, 14, 19], [4, 5, 6, 13, 14, 20], [4, 5, 6, 13, 19, 20], [4, 5, 6, 14, 19, 20], [4, 5, 7, 9, 13, 14], [4, 5, 7, 9, 13, 19], [4, 5, 7, 9, 13, 20], [4, 5, 7, 9, 14, 19], [4, 5, 7, 9, 14, 20], [4, 5, 7, 9, 19, 20], [4, 5, 7, 13, 14, 19], [4, 5, 7, 13, 14, 20], [4, 5, 7, 13, 19, 20], [4, 5, 7, 14, 19, 20], [4, 5, 9, 13, 14, 19], [4, 5, 9, 13, 14, 20], [4, 5, 9, 13, 19, 20], [4, 5, 9, 14, 19, 20], [4, 5, 13, 14, 19, 20], [4, 6, 7, 9, 13, 14], [4, 6, 7, 9, 13, 19], [4, 6, 7, 9, 13, 20], [4, 6, 7, 9, 14, 19], [4, 6, 7, 9, 14, 20], [4, 6, 7, 9, 19, 20], [4, 6, 7, 13, 14, 19], [4, 6, 7, 13, 14, 20], [4, 6, 7, 13, 19, 20], [4, 6, 7, 14, 19, 20], [4, 6, 9, 13, 14, 19], [4, 6, 9, 13, 14, 20], [4, 6, 9, 13, 19, 20], [4, 6, 9, 14, 19, 20], [4, 6, 13, 14, 19, 20], [4, 7, 9, 13, 14, 19], [4, 7, 9, 13, 14, 20], [4, 7, 9, 13, 19, 20], [4, 7, 9, 14, 19, 20], [4, 7, 13, 14, 19, 20], [4, 9, 13, 14, 19, 20], [5, 6, 7, 9, 13, 14], [5, 6, 7, 9, 13, 19], [5, 6, 7, 9, 13, 20], [5, 6, 7, 9, 14, 19], [5, 6, 7, 9, 14, 20], [5, 6, 7, 9, 19, 20], [5, 6, 7, 13, 14, 19], [5, 6, 7, 13, 14, 20], [5, 6, 7, 13, 19, 20], [5, 6, 7, 14, 19, 20], [5, 6, 9, 13, 14, 19], [5, 6, 9, 13, 14, 20], [5, 6, 9, 13, 19, 20], [5, 6, 9, 14, 19, 20], [5, 6, 13, 14, 19, 20], [5, 7, 9, 13, 14, 19], [5, 7, 9, 13, 14, 20], [5, 7, 9, 13, 19, 20], [5, 7, 9, 14, 19, 20], [5, 7, 13, 14, 19, 20], [5, 9, 13, 14, 19, 20], [6, 7, 9, 13, 14, 19], [6, 7, 9, 13, 14, 20], [6, 7, 9, 13, 19, 20], [6, 7, 9, 14, 19, 20], [6, 7, 13, 14, 19, 20], [6, 9, 13, 14, 19, 20], [7, 9, 13, 14, 19, 20]]


#combinations=[[5,6,7,9], [5,6,7,9,21], [6,7,9,10], [6,7,9,10,21]]
#success=[]
#results=[]
#for combination in combinations[:] :
#    pdb_optimized, All_results, unoptimized = Dependent_Trial(Meta_data, combination)
#    success.append(int(pdb_optimized))
#    results.append(All_results)

#maxx = max(success)
#max_index = success.index(maxx)

#print(unoptimized)

#target = results[max_index]
#target_filt = []
#for dic in target :
#    if dic["min_value"] != 0 and dic["min_value"] < -1e-3 :
#        target_filt.append(dic)

#print(maxx)
#print(combinations[max_index])
#print(target_filt[-1]["x1"], target_filt[-1]["x2"], target_filt[-1]["x3"], target_filt[-1]["x4"])
#print(target_filt[-1]["x1"], target_filt[-1]["x2"], target_filt[-1]["x3"], target_filt[-1]["x4"], target_filt[-1]["x5"], target_filt[-1]["x6"])
#print(target_filt[-1]["x1"], target_filt[-1]["x2"], target_filt[-1]["x3"], target_filt[-1]["x4"], target_filt[-1]["x5"], target_filt[-1]["x6"], target_filt[-1]["x7"], target_filt[-1]["x8"])

combination=[6,7,9,10]
target_filt=[]
_, All_results, _ = Dependent_Trial(Meta_data, combination)
for dic in All_results :
    if dic["min_value"] != 0 and dic["min_value"] < -1e-3 :
        target_filt.append(dic)

coef=[]
for num in range(1, len(combination)+1) :
    coef.append(target_filt[-1][f"x{num}"])


